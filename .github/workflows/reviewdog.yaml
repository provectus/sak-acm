name: reviewdog
on:
  pull_request:
    paths:
    - '**.tf'
    - '**.tfvars'
    - '**.tfvars.json'

jobs:

  tflint:
    name: runner / tflint
    runs-on: ubuntu-latest

    steps:
      - name: Clone repo
        uses: actions/checkout@master

      - name: Clone infra repo
        run: |
        echo "TF_DIR=$(pwd)" >> $GITHUB_ENV
        echo "Terraform will be triggered in this dir $TF_DIR"

      - name: Terraform Install
        uses: hashicorp/setup-terraform@v2

      - name: Terraform format
        id: fmt
        run: cd $TF_DIR && terraform fmt -check

      # Run init to get module code to be able to use `--module`
      - name: Terraform init common
        run: |
          cd $TF_DIR && terraform init --upgrade

      # More complex example
      - name: tflint common
        uses: reviewdog/action-tflint@master
        with:
          github_token: ${{ secrets.github_token }}
          reporter: github-pr-review # Optional. Change reporter
          fail_on_error: "true" # Optional. Fail action if errors are found
          filter_mode: "nofilter" # Optional. Check all files, not just the diff
          level: info
          flags: "--module" # Optional. Add custom tflint flags
